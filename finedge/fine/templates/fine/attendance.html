{% extends 'fine/base.html' %}
{% load static %}

{% block title %}Attendance Management{% endblock %}

{% block content %}
<!-- Attendance Management Page -->
<div id="attendance-page">
  <div class="attendance-header">
    <div>
      <h2 class="mb-1">Attendance Management</h2>
      <p class="text-muted mb-0">Track employee attendance for current week</p>
    </div>
    <div class="attendance-controls">
      <button class="btn btn-success me-2" id="save-attendance-btn">
        <i class="fas fa-save me-1"></i> Save Attendance
      </button>
      <button class="btn btn-info" id="view-records-btn">
        <i class="fas fa-eye me-1"></i> View Records
      </button>
      <button class="btn btn-primary ms-3" id="new-add-employee-btn">
        <i class="fas fa-user-plus me-1"></i> Add Employee
      </button>
    </div>
  </div>

  <!-- Summary Cards (Today's attendance only) -->
  <div class="attendance-summary-cards row mb-4">
    <div class="col-md-3">
      <div class="summary-card total-employees">
        <div class="summary-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="summary-content">
          <h3 id="total-employees-count">0</h3>
          <p>Total Employees</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="summary-card week-present">
        <div class="summary-icon">
          <i class="fas fa-user-check"></i>
        </div>
        <div class="summary-content">
          <h3 id="today-present-count">0</h3>
          <p>Present Today</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="summary-card week-absent">
        <div class="summary-icon">
          <i class="fas fa-user-times"></i>
        </div>
        <div class="summary-content">
          <h3 id="today-absent-count">0</h3>
          <p>Absent Today</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="summary-card week-halfday">
        <div class="summary-icon">
          <i class="fas fa-user-clock"></i>
        </div>
        <div class="summary-content">
          <h3 id="today-halfday-count">0</h3>
          <p>Half Days Today</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Attendance Table -->
  <div class="card weekly-attendance-table">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0" id="weekly-attendance-table">
          <thead>
            <tr>
              <th class="employee-name-column">Employee Name</th>
              <!-- Dynamic week headers will be inserted here -->
              <th class="actions-column">Actions</th>
            </tr>
          </thead>
          <tbody id="weekly-attendance-body">
            <!-- Employee rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- View Records Modal -->
<div class="modal fade" id="viewRecordsModal" tabindex="-1">
  <div class="modal-dialog modal-lg" style="max-width: 80%;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Attendance Records</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" style="max-height: 65vh; overflow-y: auto;">
        <!-- Simplified Filter Controls -->
        <div class="row mb-4 g-3">
          <div class="col-md-6">
            <label class="form-label">Date Filter</label>
            <input type="date" class="form-control" id="filter-date">
          </div>
          <div class="col-md-6">
            <label class="form-label">Employee Filter</label>
            <select class="form-select" id="filter-employee">
              <option value="">All Employees</option>
              <!-- Employee options will be populated dynamically -->
            </select>
          </div>
          <div class="col-md-12">
            <button class="btn btn-primary w-100" id="apply-filters-btn">
              <i class="fas fa-filter me-1"></i> Apply Filters
            </button>
          </div>
        </div>

        <!-- Simplified Records Table -->
        <div class="table-responsive">
          <table class="table table-hover" id="records-table">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="records-table-body">
              <!-- Records will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Attendance Modal -->
<div class="modal fade" id="editAttendanceModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Attendance</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editAttendanceForm">
          <input type="hidden" id="edit-record-id">
          <input type="hidden" id="edit-employee-id">
          <input type="hidden" id="edit-date">
          
          <div class="mb-3">
            <label class="form-label">Employee</label>
            <input type="text" class="form-control" id="edit-attendance-employee-name" readonly>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Date</label>
            <input type="date" class="form-control" id="edit-attendance-date">
          </div>
          
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" id="edit-attendance-status">
              <option value="1">Present</option>
              <option value="0.5">Half Day</option>
              <option value="0">Absent</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Notes (Optional)</label>
            <textarea class="form-control" id="edit-attendance-notes" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="delete-attendance-btn">
          <i class="fas fa-trash me-1"></i> Delete
        </button>
        <button type="button" class="btn btn-primary" id="update-attendance-btn">
          <i class="fas fa-save me-1"></i> Update
        </button>
      </div>
    </div>
  </div>
</div>

<!-- New Add Employee Modal -->
<div class="modal fade" id="newAddEmployeeModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Employee</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="newEmployeeForm">
          <div class="mb-3">
            <label for="newEmployeeName" class="form-label">Employee Name *</label>
            <input type="text" class="form-control" id="newEmployeeName" 
                   placeholder="Enter employee name" required>
            <div class="form-text">Enter the full name of the employee</div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveNewEmployeeBtn">Add Employee</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'fine/js/attendance.js' %}"></script>
{% endblock %}